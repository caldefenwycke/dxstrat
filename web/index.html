<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Darwin X Pool</title>
  <meta name="description" content="Mine bitcoin with Darwin X — intelligent header generation + minimal, fast pool UI." />
  <style>
    :root {
      color-scheme: dark;
      --bg: #0b0d10;
      --panel: #0f1419;
      --muted: #92a2b2;
      --text: #e7edf3;
      --accent: #4dd2ff;
      --good: #41d17d;
      --warn: #f2c14e;
      --bad:  #ff6b6b;
      --rad: 18px;
      --gap: 16px;
      --pad: 20px;
      --maxw: 1100px;
    }
    html, body { height: 100%; }
    body { margin:0; font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, sans-serif; background: var(--bg); color: var(--text); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 0 20px; }
    header.site {
      position: sticky; top: 0; z-index: 50; backdrop-filter: saturate(120%) blur(8px);
      background: color-mix(in oklab, var(--bg) 92%, transparent);
      border-bottom: 1px solid #0f1822;
    }
    .nav { display: flex; align-items: center; justify-content: space-between; height: 60px; }
    .brand { display:flex; align-items:center; gap:10px; font-weight: 700; letter-spacing:.2px; }
    .brand .bolt { font-size: 18px; }
    .menu { display: flex; gap: 14px; font-size: 15px; }
    .menu a { padding: 8px 10px; border-radius: 10px; }
    .menu a:hover { background: #0f1419; text-decoration: none; }

    .hero { padding: 34px 0 10px; }
    .hero h1 { margin: 0 0 8px; font-size: clamp(26px, 2.6vw + 16px, 40px); letter-spacing:.2px; }
    .hero p.lead { margin: 0; color: var(--muted); font-size: clamp(15px, 1vw + 12px, 18px); }

    .two-col { display:grid; grid-template-columns: 1fr; gap: var(--gap); margin: 22px 0 10px; }
    @media (min-width: 860px) { .two-col { grid-template-columns: 1fr 1fr; } }

    .card { background: var(--panel); border: 1px solid #13202c; border-radius: var(--rad); padding: var(--pad); box-shadow: 0 0 0 1px rgba(255,255,255,0.015) inset; }
    .card h3 { margin: 0 0 10px; font-size: 16px; text-transform: uppercase; letter-spacing: .12em; color: var(--muted); }
    .row { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }

    .kv { display:flex; align-items:center; justify-content: space-between; padding: 10px 12px; background:#0b1218; border:1px solid #13202c; border-radius:12px; }
    .kv .k { color: var(--muted); font-size: 13px; }
    .kv .v { font-weight: 600; }

    .endpoint { display:flex; gap:10px; }
    .endpoint input { flex:1; background:#0b1218; border:1px solid #152232; color:var(--text); padding:10px 12px; border-radius:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .btn { background:#121a22; border:1px solid #1a2a3a; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; }
    .btn:hover { background:#141e28; }

    .full { margin:28px 0 40px; }
    .full .section { margin: 0 0 16px; }
    .full h2 { margin: 26px 0 10px; font-size: 20px; letter-spacing:.3px; }
    .muted { color: var(--muted); }

    .tag { display:inline-block; border:1px solid #203140; background:#0b1218; padding:3px 8px; border-radius:999px; font-size:12px; color:var(--muted); }
    .grid-3 { display:grid; gap: var(--gap); grid-template-columns: 1fr; }
    @media (min-width: 980px) { .grid-3 { grid-template-columns: repeat(3, 1fr); } }

    .miner-lookup { display:flex; gap:10px; margin-top:8px; }
    .miner-lookup input { flex:1; background:#0b1218; border:1px solid #152232; color:var(--text); padding:10px 12px; border-radius:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    .tbl { width:100%; border-collapse: collapse; font-size:14px; }
    .tbl th, .tbl td { padding:10px 8px; border-bottom:1px solid #182532; text-align:left; }
    .pill { padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #244055; }

    footer { padding: 30px 0 40px; color: var(--muted); text-align:center; border-top:1px solid #0f1822; }

    .small { font-size: 12.5px; }
    .ok { color: var(--good); }
    .warn { color: var(--warn); }
    .bad { color: var(--bad); }

    html { scroll-behavior: smooth; }
    .sp { height: 1px; margin-top: 70px; } /* anchor spacer */
  </style>
</head>
<body>
  <header class="site">
    <div class="wrap nav">
      <div class="brand"><span class="bolt">⚡</span> Darwin X</div>
      <nav class="menu">
        <a href="#pool">Pool</a>
        <a href="#miner">Miner</a>
        <a href="#headers">Headers</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1>Mine bitcoin with Darwin X pool</h1>
      <p class="lead">Intelligent header generation, combined with a minimal, fast pool UI. Just point your miner and hash.</p>
    </section>

    <div class="sp" id="pool"></div>

    <section class="two-col">
      <!-- Left: Stratum endpoint -->
      <div class="card">
        <h3>Stratum endpoint</h3>
        <div class="endpoint">
          <input id="endpoint" value="stratum+tcp://pool.dxstrat.com:3333" readonly />
          <button class="btn" id="copyEp">Copy</button>
        </div>
        <p class="small muted" style="margin-top:8px">User: <code>&lt;your-bitcoin-address&gt;</code> · Password: <code>x</code></p>
        <div class="row" style="margin-top:10px">
          <div class="kv"><span class="k">Pool fee</span><span class="v" id="poolFee">—</span></div>
          <div class="kv"><span class="k">Min payout</span><span class="v" id="minPayout">1,000,000 sats</span></div>
        </div>
      </div>

      <!-- Right: Pool status snapshot -->
      <div class="card">
        <h3>Pool status</h3>
        <div class="row">
          <div class="kv"><span class="k">Hashrate</span><span class="v" id="poolHash">—</span></div>
          <div class="kv"><span class="k">Miners online</span><span class="v" id="minersOnline">—</span></div>
          <div class="kv"><span class="k">24h blocks</span><span class="v" id="blocks24h">—</span></div>
          <div class="kv"><span class="k">Round shares</span><span class="v" id="roundShares">—</span></div>
        </div>
        <p class="small muted" style="margin-top:8px">Auto-refreshes every 30s.</p>
      </div>
    </section>

    <!-- Miner section -->
    <div class="sp" id="miner"></div>
    <section class="card" style="margin-top:18px">
      <h3>Miner stats</h3>
      <div class="miner-lookup">
        <input id="minerAddr" placeholder="Enter your BTC address to find workers" />
        <button class="btn" id="lookupBtn">Search</button>
      </div>
      <div id="minerResult" style="margin-top:14px" class="small muted">Enter your address to view worker hashrates and last shares.</div>
    </section>

    <!-- Headers section -->
    <div class="sp" id="headers"></div>
    <section class="card" style="margin-top:18px">
      <h3>Header generation</h3>
      <div class="row">
        <div class="kv"><span class="k">Headers / sec</span><span class="v" id="hdrRate">—</span></div>
        <div class="kv"><span class="k">Target</span><span class="v" id="hdrTarget">—</span></div>
        <div class="kv"><span class="k">Orphan rate</span><span class="v" id="orphanRate">—</span></div>
        <div class="kv"><span class="k">Last 1 min</span><span class="v" id="hdr1m">—</span></div>
      </div>
      <p class="small muted" id="hdrNote" style="margin-top:8px">If header metrics aren't available yet, this section will populate once the stratum engine begins generating headers.</p>
    </section>

    <!-- Full-width content blocks -->
    <section class="full">
      <div class="grid-3">
        <div class="card section" id="settings">
          <h2>Miner settings</h2>
          <p>Point any SHA-256 miner at our stratum endpoint. Use your Bitcoin address as the username and any password (e.g. <code>x</code>).</p>
          <ul class="small muted">
            <li>URL: <code id="epText2">stratum+tcp://pool.dxstrat.com:3333</code></li>
            <li>User: <code>&lt;your-bitcoin-address&gt;</code></li>
            <li>Pass: <code>x</code></li>
          </ul>
        </div>
        <div class="card section" id="tips">
          <h2>Miner tips</h2>
          <ul class="small">
            <li>Keep firmware updated; aim for stable temps and power.</li>
            <li>Use a worker suffix (e.g. <code>bc1...worker1</code>) to see per-rig stats.</li>
            <li>Prefer wired networking; avoid packet loss for steady shares.</li>
          </ul>
        </div>
        <div class="card section" id="fees">
          <h2>Fees & payouts</h2>
          <p class="small">Pool fee: <strong id="poolFee2">—</strong>. Payouts run daily at <strong id="payoutHour">02:00 UTC</strong> with a minimum of <strong id="minPayout2">1,000,000 sats</strong>.</p>
          <p class="muted small">We use a transparent score-based system with variance smoothing.</p>
        </div>
      </div>

      <div class="grid-3" style="margin-top: var(--gap)">
        <div class="card section" id="transparency">
          <h2>Transparency</h2>
          <p class="small">Stats, fees and payouts are shown in real-time. Our coinbase tag is <code>/DarwinXPool/</code>.</p>
        </div>
        <div class="card section" id="api">
          <h2>API</h2>
          <p class="small">Public JSON endpoints:</p>
          <ul class="small">
            <li><code>GET /api/pool</code> — name, domain, fee</li>
            <li><code>GET /api/stats</code> — hashrates & online miners</li>
            <li><code>GET /api/miner/&lt;address&gt;</code> — your workers</li>
          </ul>
          <p class="small muted">More endpoints coming—header telemetry, rounds and blocks.</p>
        </div>
        <div class="card section" id="why">
          <h2>Why choose Darwin X?</h2>
          <ul class="small">
            <li>Intelligent header generation tuned for low stale rates.</li>
            <li>Simple UI; zero bloat. Fast JSON API.</li>
            <li>Fair, predictable payouts with clear rules.</li>
          </ul>
        </div>
      </div>

      <div class="grid-3" style="margin-top: var(--gap)">
        <div class="card section" id="faq">
          <h2>FAQ</h2>
          <p class="small"><strong>When do I get paid?</strong> Daily at <span id="payoutHour2">02:00 UTC</span> once you pass the minimum.</p>
          <p class="small"><strong>What is the minimum?</strong> <span id="minPayout3">1,000,000 sats</span>.</p>
          <p class="small"><strong>How do I see my miners?</strong> Use your BTC address in the search above.</p>
        </div>
        <div class="card section" id="support">
          <h2>Support</h2>
          <p class="small">Need help? Email <a href="mailto:support@dxstrat.com">support@dxstrat.com</a> or join our Discord (link on request).</p>
        </div>
        <div class="card section">
          <h2>Status</h2>
          <p class="small">API health: <span id="apiHealth" class="pill">checking…</span></p>
          <p class="small">Web last updated: <time id="buildTime"></time></p>
        </div>
      </div>
    </section>

    <footer>© 2025 Darwin X. Hash smarter. ⚡</footer>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const fmt = {
      int: (n) => (n==null?"—":Number(n).toLocaleString()),
      sats: (n) => (n==null?"—":`${Number(n).toLocaleString()} sats`),
      rate: (h) => {
        if (h==null) return "—";
        const units = ["H/s","kH/s","MH/s","GH/s","TH/s","PH/s","EH/s"];
        let i = 0; let v = Number(h);
        while (v >= 1000 && i < units.length-1) { v/=1000; i++; }
        return `${v.toFixed(v<10?2:1)} ${units[i]}`;
      }
    };

    async function fetchJSON(url, {timeout=8000}={}) {
      const ctrl = new AbortController();
      const id = setTimeout(()=>ctrl.abort(), timeout);
      try {
        const r = await fetch(url, {signal: ctrl.signal});
        if (!r.ok) throw new Error(`${r.status}`);
        return await r.json();
      } finally { clearTimeout(id); }
    }

    // Populate build time
    $('#buildTime').textContent = new Date().toUTCString();

    // Pool + stats
    let domain = location.host;
    let stratumPort = 3333;
    let payoutMin = 1_000_000;   // default fallback
    let payoutHour = '02';       // default fallback (UTC hour string)

    function applyEndpoints() {
      const ep = `stratum+tcp://pool.${domain.replace(/^pool\./,'')}:` + stratumPort;
      $('#endpoint').value = ep;
      $('#epText2').textContent = ep;
    }

    async function loadPool() {
      try {
        const p = await fetchJSON('/api/pool');
        if (p?.domain) domain = p.domain; // backend domain (dxstrat.com)
        if (p?.stratum_port) stratumPort = p.stratum_port;
        if (p?.fee_percent != null) {
          $('#poolFee').textContent = p.fee_percent + '%';
          $('#poolFee2').textContent = p.fee_percent + '%';
        }
        if (p?.payout_min_sats != null) payoutMin = p.payout_min_sats;
        if (p?.payout_daily_hour_utc) payoutHour = String(p.payout_daily_hour_utc).padStart(2,'0');
      } catch {}
      applyEndpoints();
      // reflect payouts
      $('#minPayout').textContent = fmt.sats(payoutMin);
      $('#minPayout2').textContent = fmt.sats(payoutMin);
      $('#minPayout3').textContent = fmt.sats(payoutMin);
      $('#payoutHour').textContent = `${payoutHour}:00 UTC`;
      $('#payoutHour2').textContent = `${payoutHour}:00 UTC`;
    }

    async function loadStats() {
      let ok = false;
      try {
        const s = await fetchJSON('/api/stats');
        ok = true;
        if (s?.pool_hashrate != null) $('#poolHash').textContent = fmt.rate(s.pool_hashrate);
        if (s?.miners_online != null) $('#minersOnline').textContent = fmt.int(s.miners_online);
        if (s?.blocks_24h != null) $('#blocks24h').textContent = fmt.int(s.blocks_24h);
        if (s?.round_shares != null) $('#roundShares').textContent = fmt.int(s.round_shares);
        if (s?.stratum_port != null) { stratumPort = s.stratum_port; applyEndpoints(); }
        // Try to surface header metrics if folded into stats
        if (s?.header_rate != null) $('#hdrRate').textContent = fmt.int(s.header_rate);
        if (s?.headers_last_1m != null) $('#hdr1m').textContent = fmt.int(s.headers_last_1m);
        if (s?.orphan_rate != null) $('#orphanRate').textContent = s.orphan_rate + '%';
        if (s?.headers_target != null) $('#hdrTarget').textContent = fmt.int(s.headers_target);
      } catch {}
      $('#apiHealth').textContent = ok ? 'OK' : 'unreachable';
      $('#apiHealth').className = 'pill ' + (ok ? 'ok' : 'bad');
    }

    async function loadHeaders() {
      // Optional endpoint. If missing, we keep what's set by loadStats.
      try {
        const h = await fetchJSON('/api/headers');
        if (h?.rate != null) $('#hdrRate').textContent = fmt.int(h.rate);
        if (h?.target != null) $('#hdrTarget').textContent = fmt.int(h.target);
        if (h?.orphan_rate != null) $('#orphanRate').textContent = h.orphan_rate + '%';
        if (h?.last_1m != null) $('#hdr1m').textContent = fmt.int(h.last_1m);
        $('#hdrNote').textContent = 'Live header telemetry';
        $('#hdrNote').classList.remove('muted');
      } catch {}
    }

    async function lookupMiner(addr) {
      const out = $('#minerResult');
      if (!addr || addr.length < 8) { out.textContent = 'Enter your address to view workers.'; return; }
      out.textContent = 'Loading…';
      try {
        const m = await fetchJSON(`/api/miner/${encodeURIComponent(addr)}`);
        if (!m || (!m.workers && !m.hashrate)) { out.textContent = 'No data for that address yet.'; return; }
        const workers = m.workers || [];
        let html = '';
        html += `<div class="kv" style="margin-bottom:8px"><span class="k">Miner hashrate</span><span class="v">${fmt.rate(m.hashrate || 0)}</span></div>`;
        if (workers.length) {
          html += '<div style="overflow:auto">\n<table class="tbl">\n<thead><tr><th>Worker</th><th>Hashrate</th><th>Last share</th><th>Accepted</th><th>Rejected</th></tr></thead><tbody>';
          for (const w of workers) {
            html += `<tr><td>${w.name || '—'}</td><td>${fmt.rate(w.hashrate||0)}</td><td>${w.last_share_ago || '—'}</td><td>${fmt.int(w.accepted||0)}</td><td>${fmt.int(w.rejected||0)}</td></tr>`;
          }
          html += '</tbody></table></div>';
        }
        out.innerHTML = html;
      } catch (e) {
        out.textContent = 'Lookup failed. Try again in a moment.';
      }
    }

    $('#copyEp').addEventListener('click', async () => {
      try { await navigator.clipboard.writeText($('#endpoint').value); $('#copyEp').textContent = 'Copied'; setTimeout(()=>$('#copyEp').textContent='Copy', 1200);} catch {}
    });
    $('#lookupBtn').addEventListener('click', ()=> lookupMiner($('#minerAddr').value.trim()));
    $('#minerAddr').addEventListener('keydown', (e)=>{ if(e.key==='Enter') $('#lookupBtn').click(); });

    // initial load + polling
    loadPool();
    loadStats();
    loadHeaders();
    setInterval(loadStats, 30_000);
  </script>
</body>
</html>
